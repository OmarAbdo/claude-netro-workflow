{
  "SessionStart": [
    {
      "hooks": [
        {
          "type": "prompt",
          "prompt": "On session start, perform these checks:\n\n1. **Memory Restoration**: Check for saved state:\n   - .claude/memory/session-state.json (project level)\n   - If found, summarize: task, progress (X/Y done), resume instructions\n   - Offer to restore todos from saved progress\n\n2. **Linear Issue Detection**: Check git branch for issue ID (e.g., MYT-123):\n   - If found and Linear MCP available, fetch issue details\n   - Show title, status, labels\n\n3. **Continuous Mode Check**: Check .claude/continuous-mode.json:\n   - If enabled, note that continuous mode is active\n   - Show remaining tasks\n\nRespond with JSON:\n{\"ok\": true, \"context\": \"Summary of restored context, Linear issue, and mode status\"}",
          "timeout": 20
        }
      ]
    }
  ],
  "Stop": [
    {
      "hooks": [
        {
          "type": "prompt",
          "prompt": "Before stopping, perform these checks:\n\n1. **Save Memory State**:\n   - Save current progress to .claude/memory/session-state.json\n   - Include: task description, completed/remaining todos, resume instructions\n\n2. **Continuous Mode Check**:\n   - Check if .claude/continuous-mode.json exists and enabled=true\n   - If continuous mode ON and incomplete work exists, respond {\"ok\": false}\n\n3. **Completion Verification** (STRICT):\n   - Were ALL user-requested tasks completed (not partially)?\n   - Are there remaining incomplete todos in TodoWrite?\n   - If tests were requested, did ALL pass?\n   - If coverage specified, was target verified?\n   - If 'ALL' was requested, were all items actually processed?\n\nBe STRICT:\n- 'Most' is not 'all'\n- 'Should work' is not 'verified working'\n- Partial = incomplete\n\nRespond with JSON:\n- {\"ok\": true} ONLY if work is complete AND (continuous mode off OR no work remains)\n- {\"ok\": false, \"reason\": \"[Continuous mode: X tasks remaining] OR [Incomplete: specific items]\"} otherwise",
          "timeout": 60
        }
      ]
    }
  ],
  "PreCompact": [
    {
      "hooks": [
        {
          "type": "prompt",
          "prompt": "Context is about to be compacted at 90% threshold. CRITICAL: Save state NOW.\n\n**IMMEDIATELY save these files:**\n\n1. **Save .claude/memory/session-state.json** with:\n   - Current task description\n   - Progress: completed, in-progress, remaining todos (from TodoWrite)\n   - Key files read/modified this session\n   - Key decisions made\n   - SPECIFIC resume instructions (what to do next)\n\n2. **Save .claude/memory/task-context.md** (human-readable version)\n\n3. **Create .claude/pending-restore** flag file (empty file, signals auto-restore needed)\n\nThis is your LAST CHANCE to save state before compaction. Be thorough.\n\nAfter saving, respond {\"ok\": true}.",
          "timeout": 45
        }
      ]
    }
  ],
  "UserPromptSubmit": [
    {
      "hooks": [
        {
          "type": "prompt",
          "prompt": "Check if .claude/pending-restore file exists (signals post-compaction restore needed).\n\nIf the file EXISTS:\n1. Read .claude/memory/session-state.json\n2. Display restored context to user:\n   - Task: [description]\n   - Progress: X completed, Y remaining\n   - Resume: [instructions]\n3. Restore todos from saved progress using TodoWrite\n4. DELETE the .claude/pending-restore file\n5. Respond {\"ok\": true, \"restored\": true}\n\nIf the file does NOT exist:\n- Respond {\"ok\": true} silently (no restoration needed)\n\nThis enables seamless continuation after context compaction.",
          "timeout": 30
        }
      ]
    }
  ],
  "PostToolUse": [
    {
      "matcher": "Bash",
      "hooks": [
        {
          "type": "command",
          "command": "python \"${CLAUDE_PLUGIN_ROOT}/hooks/scripts/capture-large-output.py\"",
          "timeout": 10
        }
      ]
    }
  ],
  "PreToolUse": [
    {
      "matcher": "TodoWrite",
      "hooks": [
        {
          "type": "prompt",
          "prompt": "The user expects granular task tracking. Ensure todos are:\n1. Specific and actionable (not vague like 'implement feature')\n2. Cover ALL aspects of the user's request\n3. Include verification steps (run tests, check coverage, etc.)\n4. Broken down into atomic units that can be marked complete individually\n\nIf the current todo list seems incomplete for the user's request, respond {\"ok\": false, \"reason\": \"Missing todos for: X, Y, Z\"}.\n\nRespond {\"ok\": true} if the todos adequately cover the user's requirements.",
          "timeout": 30
        }
      ]
    }
  ]
}
